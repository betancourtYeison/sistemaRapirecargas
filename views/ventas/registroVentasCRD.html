<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Registro de Ventas 
  </h1>
  <ol class="breadcrumb">
    <li><a href="#/"><i class="fa fa-home"></i> Inicio</a></li>
    <li><a href="#/registroVentasCRD">Ventas</a></li>
    <li class="active">Registro de Ventas</li>
  </ol>
</section>

<!-- Main content -->
<section class="content"> 
  <div class="row" id="pdf2htmldiv">
    <div class="col-lg-12">      
      <form id="form-registro-compra" role="form" name="form" ng-controller="ClientesCtrlCRD">        
        <div class="row">
          <div class="col-md-2">            
            Datos del Cliente:  
            <div class="form-group has-feedback" ng-class="{'has-error': form.name.$invalid, 'has-success': form.name.$valid}">           
              <input id="inputname" type="text" class="form-control" autocomplete="off" placeholder="Buscar por nombre" aria-label="..." name="name" ng-model="customerName" ng-change="loadNameCustomer()" style="padding-right: 0px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerName">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('nombre', customer.nombre, customer.id, customer.telefono)">
                      {{ customer.nombre }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.name.$dirty && form.name.$invalid">
                <p class="help-block text-danger" ng-show="form.name.$error.required">Campo obligatorio</p>
              </div>           
            </div>        
          </div>
          <div class="col-md-2"> 
            &nbsp;                     
            <div class="form-group has-feedback" ng-class="{'has-error': form.id.$invalid, 'has-success': form.id.$valid}">           
              <input id="inputId" type="text" class="form-control" autocomplete="off" placeholder="Buscar por cédula" aria-label="..." name="id" ng-model="customerId" ng-change="loadIdCustomer()" style="padding-right: 0px;" required/>  
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerId">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('id', customer.nombre, customer.id, customer.telefono)">
                      {{ customer.id }}
                  </a>
                </li>
              </ul>
              <div ng-show="form.id.$dirty && form.id.$invalid">
                <p class="help-block text-danger" ng-show="form.id.$error.required">Campo obligatorio</p>
              </div>           
            </div>        
          </div>
          <div class="col-md-2">            
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.phone.$invalid, 'has-success': form.phone.$valid}">           
              <input id="inputPhone" type="text" class="form-control" autocomplete="off" placeholder="Buscar por teléfono" aria-label="..." name="phone" ng-model="customerPhone" ng-change="loadPhoneCustomer()" style="padding-right: 0px;" required/>                    
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-customerPhone">
                <li ng-repeat="customer in customers">
                  <a style="cursor: pointer;" ng-click="changeCustomer('telefono', customer.nombre, customer.id, customer.telefono)">
                      {{ customer.telefono }}
                  </a>
                </li>
              </ul>  
              <div ng-show="form.phone.$dirty && form.phone.$invalid">
                <p class="help-block text-danger" ng-show="form.phone.$error.required">Campo obligatorio</p>
              </div>         
            </div>        
          </div>
          <div class="col-md-2">
            &nbsp;
            <div class="input-group">            
              <button type="button" class="form-control btn btn-success" data-toggle="modal" data-target="#newProvider" aria-describedby="basic-addon2">Nuevo Cliente</button> 
              <span class="input-group-addon" id="basic-addon2"><a data-toggle="modal" data-target="#newProvider"><span class="glyphicon glyphicon-plus"></span></a></span>
            </div>
          </div>
          <div class="col-md-2 pull-right"> 
            <div>No. Factura: <input id="factura" type="text" class="col-md-2 form-control" ng-model="noFactura" disabled="">
            </div>
          </div>
          <div class="col-md-2 pull-right"> 
            <div>Fecha: <input id="txt_fecha" type="text" class="col-md-2 form-control" ng-model="fecha" disabled="">
            </div>
          </div>
        </div>              
        <br>      
        <div class="row" ng-controller="ListadoProductosCtrlCRD">
          <div class="col-md-2">  
            <div>Datos del Producto: 
              <div class="form-group has-feedback" ng-class="{'has-error': form.ref.$invalid, 'has-success': form.ref.$valid}">
                <input id="inputname" type="text" class="form-control" autocomplete="off" placeholder="Buscar por descripción" aria-label="..." name="ref" ng-model="productDescrip" ng-change="loadProductDescrip()" style="padding-right: 0px;" required/>
                <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productDescrip">
                  <li ng-repeat="product in productsList">                  
                    <a style="cursor: pointer;" ng-click="changeProduct('descripcion', product.referencia, product.descripcion, product.codigoBarras, product.precioUnitario)">
                        {{ product.descripcion }}
                    </a>
                  </li>
                </ul> 
                <div ng-show="form.ref.$dirty && form.ref.$invalid">
                  <p class="help-block text-danger" ng-show="form.ref.$error.required">Campo obligatorio</p>
                </div>           
              </div>                    
            </div>
          </div>
          <div class="col-md-2">  
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.cod.$invalid, 'has-success': form.cod.$valid}">           
              <input id="inputcod" type="text" class="form-control" autocomplete="off" placeholder="Buscar por código" aria-label="..." name="cod" ng-model="productCod" ng-change="loadProductCodigo()" style="padding-right: 0px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productCod">
                <li ng-repeat="product in productsList">
                  <a style="cursor: pointer;" ng-click="changeProduct('codigoBarras', product.referencia, product.descripcion, product.codigoBarras, product.precioUnitario)">
                      {{ product.codigoBarras }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.cod.$dirty && form.cod.$invalid">
                <p class="help-block text-danger" ng-show="form.cod.$error.required">Campo obligatorio</p>
              </div>           
            </div>            
          </div>
          <div class="col-md-2"> 
            &nbsp;
            <div class="form-group has-feedback" ng-class="{'has-error': form.val.$invalid, 'has-success': form.val.$valid}">           
              <input id="inputcod" type="text" class="form-control" autocomplete="off" placeholder="Buscar por precio" aria-label="..." name="val" ng-model="productVal" ng-change="loadProductValue()" style="padding-right: 5px;" required/>
              <ul class="dropdown-menu dropdown-menu-right dropdown-menu-productVal">
                <li ng-repeat="product in productsList">
                  <a style="cursor: pointer;" ng-click="changeProduct('precioUnitario', product.referencia, product.descripcion, product.codigoBarras, product.precioUnitario)">
                      {{ product.precioUnitario }}
                  </a>
                </li>
              </ul> 
              <div ng-show="form.val.$dirty && form.val.$invalid">
                  <p class="help-block text-danger" ng-show="form.val.$error.required">Campo obligatorio</p>
                </div> 
            </div>
          </div>
          <div class="col-md-2">  
            Cantidad del Producto:
            <div class="form-group has-feedback" ng-class="{'has-error': form.count.$invalid, 'has-success': form.count.$valid}">           
              <input id="inputcod" type="number" class="form-control" placeholder="###" aria-label="..." name="count" ng-model="productCount" style="padding-right: 5px;" required/>
              <div ng-show="form.count.$dirty && form.count.$invalid">
                  <p class="help-block text-danger" ng-show="form.count.$error.required">Campo obligatorio</p>
                </div> 
            </div>
          </div>
          <div class="col-md-2">
            Forma de Pago
            <div class="form-group has-feedback" ng-class="{'has-error': form.pago.$invalid, 'has-success': form.pago.$valid}">  
              <select id="inputpago" placeholder="Pago" class="form-control" name="pago" ng-model="productPago" required>
                <option value="Contado">Contado</option>
                <option value="Credito">Credito a 30 días</option>
              </select>
              <div ng-show="form.pago.$dirty && form.pago.$invalid">
                <p class="help-block text-danger" ng-show="form.pago.$error.required">Campo obligatorio</p>
              </div>  
              </div>      
          </div>
          <div class="col-md-2">
            <div class="text-center" style="padding-top: 20px;"><a ng-click="addProduct(productExists, customerName, customerId, customerPhone, productRef, productDescrip, productCod, productVal, productCount, productPago)" ng-disabled="form.$invalid" class="btn btn-md btn-success"><span class="glyphicon glyphicon-plus"></span>Agregar</a>
            </div>
          </div>
        </div>     
      </form>             
        <br>
      <!-- ADD_PAGE -->
      <form id="form-registroFactura-compra" role="form2" name="form2">
        <div class="panel panel-primary" id="detalle_compra">                       
          <div class="panel-body">
            <div id="divReport" class="table-responsive">
              <table id="table" class="table table-bordered table-hover">
                <thead>
                  <tr>                    
                    <th id="descripcion" style="width: 400px;">
                      Descripción                  
                      <span ng-hide="sort" class="fa fa-sort-amount-asc" style="cursor: pointer" ng-click="ordenarPor('-descripcion',true)"></span>
                      <span ng-show="sort" class="fa fa-sort-amount-desc" style="cursor: pointer" ng-click="ordenarPor('descripcion',false)"></span>                                    
                    </th>
                    <th id="referencia" style="width: 130px;">
                      Referencia                  
                      <span ng-hide="sort" class="fa fa-sort-amount-asc" style="cursor: pointer" ng-click="ordenarPor('-referencia',true)"></span>
                      <span ng-show="sort" class="fa fa-sort-amount-desc" style="cursor: pointer" ng-click="ordenarPor('referencia',false)"></span>                                    
                    </th>
                    <th style="width: 130px;">
                      Código                  
                      <span ng-hide="sort" class="fa fa-sort-amount-asc" style="cursor: pointer" ng-click="ordenarPor('-codigo',true)"></span>
                      <span ng-show="sort" class="fa fa-sort-amount-desc" style="cursor: pointer" ng-click="ordenarPor('codigo',false)"></span>                                    
                    </th>
                    <th style="width: 130px;">Precio Unitario</th>
                    <th style="width: 130px;">Cantidad</th>
                    <th style="width: 130px;">Precio Total</th>
                    <th style="width:20px;"> </th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="producto in datosProducto | orderBy:ordenSeleccionado | filter:buscar">                    
                    <td>{{ producto.descripcion }}</td>
                    <td>{{ producto.referencia }}</td>
                    <td>{{ producto.codigoBarras }}</td>
                    <td>{{ producto.precioUnitario }}</td>
                    <td>{{ producto.cantidad }}</td>
                    <td>{{ producto.valorTot }}</td> 
                    <td><a ng-click="deleteProduct($index,producto.codigoBarras)" class="btn btn-small btn-danger"><span class="glyphicon glyphicon-remove"></span></a></td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Sub Total</th> 
                    <th id="subTotal">{{subTotal}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Impuesto</th> 
                    <th>{{impuesto}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>    
                  <tr>
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-right-style: hidden; border-bottom-style: hidden;"></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                    <th>Descuento %</th> 
                    <th><input ng-change="calculateTot()" ng-model="descuento"/></th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th></th> 
                    <th>Total Factura</th> 
                    <th>{{total}}</th> 
                    <th style="border-bottom-style: hidden;"></th> 
                  </tr>  
                  <tr>
                    <th style="border-right-style: hidden;">
                      <div ng-show="facturaRealizada" class="alert alert-success alert-dismissible" role="alert" style="padding: 6px 35px 6px 10px; margin-bottom: 0">
                        <button type="button" class="close" ng-click="closeAlert()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <span>Se ha guardado exitosamente la factura.</span>
                      </div>
                      <div ng-hide="productExists" class="alert alert-danger alert-dismissible" role="alert" style="padding: 6px 35px 6px 10px; margin-bottom: 0">
                        <button type="button" class="close" ng-click="closeAlert()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <span>No se puede agregar el producto porque no existe.</span>
                      </div>
                      <div ng-hide="productCountMax" class="alert alert-danger alert-dismissible" role="alert" style="padding: 6px 35px 6px 10px; margin-bottom: 0">
                        <button type="button" class="close" ng-click="closeAlert()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <span>La cantidad de producto excede la cantidad actual del Stock que es: {{productCountMaxVlr}}.</span>
                      </div>
                    </th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th style="border-right-style: hidden;"></th> 
                    <th></th> 
                    <th>
                    <div class="text-center"><a ng-click="createBil()"><button type="button" ng-disabled="generarFactura" class="btn btn-md btn-success btn-grabar-compra"><span class="glyphicon glyphicon-floppy-disk"></span> Generar Factura</button></a>
                    </div>                      
                    </th> 
                    <th></th> 
                  </tr>                       
                </tfoot>            
              </table>
            </div>
          </div><!-- /.box-body -->
        </div>          
      </form>

      <div class="modal fade" id="newProvider" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-controller="ClientesCtrlCRD">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <div ng-show="clienteCreado" class="alert alert-success alert-dismissible" role="alert" style="padding: 7px 30px 6px 8px; margin: -6px 45px 1px 0px;">
                <button type="button" class="close" ng-click="closeAlert()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <span>El cliente se ha registrado exitosamente.</span>
                </div>
                <h4 class="modal-title" id="myModalLabel">Nuevo Cliente</h4>
                <div id="errorProveedor" class="text-danger"></div>
              </div>
              <div class="modal-body">
                <form id="formModal-proveedor-compra" role="formModal" name="formModal">
                   <div class="form-group has-feedback" ng-class="{'has-error': formModal.id.$invalid || exitsCustomer(), 'has-success': formModal.id.$valid}">           
                      <input id="inputid" type="text" autocomplete="off" placeholder="Id"  class="form-control" name="id" ng-model="customers.id" required>                               
                      <div ng-show="formModal.id.$dirty && formModal.id.$invalid || exitsCustomer()">
                        <p class="help-block text-danger" ng-show="formModal.id.$error.required">Campo obligatorio</p>
                        <p class="help-block text-danger" ng-show="exitsCustomer()">Ya existe un Cliente con este Id</p>
                      </div>
                  </div>
                  <div class="form-group has-feedback" ng-class="{'has-error': formModal.name.$invalid, 'has-success': formModal.name.$valid}">           
                      <input id="inputname" type="text" placeholder="Nombre"  class="form-control" name="name" ng-model="customers.name" required>                               
                      <div ng-show="formModal.name.$dirty && formModal.name.$invalid">
                        <p class="help-block text-danger" ng-show="formModal.name.$error.required">Campo obligatorio</p>
                      </div>
                  </div>               
                  <div class="form-group has-feedback" ng-class="{'has-error': formModal.email.$invalid, 'has-success': formModal.email.$valid}">           
                      <input id="inputEmail" type="email" placeholder="E-mail"  class="form-control" name="email" ng-model="customers.mail" required>                                 
                      <div ng-show="formModal.email.$dirty && formModal.email.$invalid">
                        <p class="help-block text-danger" ng-show="formModal.email.$error.required">Campo obligatorio</p>
                        <p class="help-block text-danger" ng-show="formModal.email.$error.email">Email invalido</p>
                      </div>
                  </div>
                  <div class="form-group has-feedback" ng-class="{'has-error': formModal.address.$invalid, 'has-success': formModal.address.$valid}">           
                      <input id="inputaddress" type="text" placeholder="Dirección"  class="form-control" name="address" ng-model="customers.address" required>                               
                      <div ng-show="formModal.address.$dirty && formModal.address.$invalid">
                        <p class="help-block text-danger" ng-show="formModal.address.$error.required">Campo obligatorio</p>
                      </div>
                  </div>
                  <div class="form-group has-feedback" ng-class="{'has-error': formModal.phone.$invalid, 'has-success': formModal.phone.$valid}">           
                      <input id="inputphone" type="text" placeholder="Teléfono"  class="form-control" name="phone" ng-model="customers.phone" required>                               
                      <div ng-show="formModal.phone.$dirty && formModal.phone.$invalid">
                        <p class="help-block text-danger" ng-show="formModal.phone.$error.required">Campo obligatorio</p>
                      </div>
                  </div>  
                  <div class="form-group has-feedback" ng-class="{'has-error': formModal.area.$invalid, 'has-success': formModal.area.$valid}">  
                      <select id="inputarea" placeholder="Zona" class="form-control" name="area" ng-model="customers.area" required>
                        <option>Zona Principal</option>
                        <option>Zona Rural</option>
                        <option>Zona Secundaria</option>
                      </select> 
                      <div ng-show="formModal.area.$dirty && formModal.area.$invalid">
                        <p class="help-block text-danger" ng-show="formModal.area.$error.required">Campo obligatorio</p>
                      </div>                   
                  </div>                   
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>              
                <button type="button" class="btn btn-primary btn-grabar-proveedor-compra" data-dismiss="modal" ng-click="createNewCustomer(formModal)" ng-disabled="formModal.$invalid || exitsCustomer()">Grabar</button>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>

</section><!-- /.content -->
